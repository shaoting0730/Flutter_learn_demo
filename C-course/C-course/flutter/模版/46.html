

<html lang="zh-hans"><head>
<meta charset="UTF-8">
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"


</head>
<body>
                    
<div data-v-43d7c643="" data-v-7a1f948a="" class="section-view book-section-content"><div data-v-b60f4e3a="" data-v-43d7c643="" class="section-content"><div data-v-b60f4e3a="" class="section-page book-section-view"><div data-v-b60f4e3a="" class="entry-content article-content"><h1 class="heading" data-id="heading-0">Flutter ä¸ Native é€šä¿¡ï¼šPlatformChannel</h1>
<p>æœ¬èŠ‚ä»‹ç» PlatformChannel çš„ä½¿ç”¨ã€‚</p>
<h2 class="heading" data-id="heading-1">PlatformChannel ä»‹ç»</h2>
<p>PlatformChannel ç”¨äº Flutter ä¸ Native(Androidã€iOS) ä¹‹é—´çš„æ¶ˆæ¯ä¼ é€’ã€‚</p>
<p>ä¸ä»…å¯ä»¥æ–¹ä¾¿çš„å°† Native çš„åŠŸèƒ½æ‹“å±•ç»™ Flutter ä½¿ç”¨ï¼Œè€Œä¸”ä¹Ÿèƒ½å°† Flutter çš„åŠŸèƒ½æ‰©å±•ç»™ Native ä½¿ç”¨ã€‚</p>
<h3 class="heading" data-id="heading-2">PlatformChannel çš„æ¶æ„å›¾</h3>
<p></p><figure><img class="lazyload inited loaded" data-src="https://user-gold-cdn.xitu.io/2019/3/11/1696b4f77f90f8f1?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" data-width="580" data-height="647" src="https://user-gold-cdn.xitu.io/2019/3/11/1696b4f77f90f8f1?imageView2/0/w/1280/h/960/format/webp/ignore-error/1"><figcaption></figcaption></figure><p></p>
<p>ä¸Šå›¾æ˜¯ PlatformChannel çš„æ¶æ„å›¾ï¼ŒFlutter ä¸ Native ä¹‹é—´é‡‡ç”¨çš„æ˜¯æ¶ˆæ¯ä¼ é€’çš„æ¨¡å¼ï¼Œä¸€ä¸ªæ˜¯ Clientï¼Œä¸€ä¸ªæ˜¯ Hostï¼š</p>
<ul>
<li>Client é€šè¿‡ PlatformChannel å‘ Host å‘é€æ¶ˆæ¯ã€‚</li>
<li>Host ç›‘å¬ PlatformChannelï¼Œæ¥å—æ¶ˆæ¯ï¼Œç„¶åå°†å“åº”ç»“æœå‘é€ç»™ Clientã€‚è¿™æ ·å°±å®Œæˆäº† Flutter ä¸ Native ä¹‹é—´çš„æ¶ˆæ¯ä¼ é€’ã€‚</li>
<li>è€Œä¸” Flutter ä¸ Native ä¹‹é—´çš„æ¶ˆæ¯ä¼ é€’éƒ½æ˜¯å¼‚æ­¥çš„ï¼Œæ‰€ä»¥ä¸ä¼šé˜»å¡ UIã€‚</li>
</ul>
<p>è€Œä¸”ç”±äº PlatformChannel æ˜¯åŒå·¥çš„ï¼Œæ‰€ä»¥ Flutter å’Œ Native å¯ä»¥äº’ç›¸åš Client å’Œ Hostã€‚</p>
<h3 class="heading" data-id="heading-3">PlatformChannel çš„ç§ç±»</h3>
<p>æœ‰ä¸‰ç§ PlatformChannel ç§ç±»ï¼Œé€‚ç”¨äºä¸åŒçš„åœºæ™¯ï¼š</p>
<ol>
<li>
<p>MethodChannel</p>
<p>ä»¥æ–¹æ³•çš„æ¨¡å¼ä½¿ç”¨ PlatformChannel</p>
</li>
<li>
<p>EventChannel</p>
<p>ä»¥äº‹ä»¶çš„æ¨¡å¼ä½¿ç”¨ PlatformChannel</p>
</li>
<li>
<p>BasicMessageChannel</p>
<p>å¯ä»¥åœ¨ BasicMessageChannel ä¸Šæ–¹ä¾¿çš„è¿›è¡Œè‡ªå®šä¹‰æ‰©å±•ï¼Œä¸»è¦ç”¨äºä¸ªæ€§åŒ–çš„æ‰©å±•ã€‚</p>
</li>
</ol>
<p>MethodChannel å’Œ EventChannel è¿™ä¸¤ä¸ªå·²ç»å°è£…å¥½äº†ä½¿ç”¨æ–¹å¼ï¼Œæ˜¯æˆ‘ä»¬æœ€å¸¸ç”¨çš„ï¼Œæˆ‘ä»¬ä¸€èˆ¬å¾ˆå°‘ä½¿ç”¨ BasicMessageChannelã€‚åé¢æˆ‘ä»¬ä¼šç€é‡è®²ä¸€ä¸‹ MethodChannel å’Œ EventChannel çš„ä½¿ç”¨ã€‚</p>
<h3 class="heading" data-id="heading-4">codec</h3>
<p>åˆå› ä¸ºåŒæ—¶è¦åœ¨ Flutterã€Androidã€iOS è¿™ä¸‰ä¸ªä¸åŒçš„å¹³å°ä¸Šä¼ é€’æ¶ˆæ¯ï¼Œå°±éœ€è¦å¯ä»¥åœ¨ä¸‰ä¸ªå¹³å°ä¸Šéƒ½èƒ½å¤„ç†çš„æ•°æ®ï¼Œæ‰€ä»¥éœ€è¦å¯¹ä¼ é€’çš„æ¶ˆæ¯è¿›è¡Œç¼–è§£ç ï¼Œè€Œä¸”åªèƒ½æ”¯æŒä¸€äº›åŸºæœ¬æ•°æ®ç±»å‹çš„ä¼ é€’ï¼Œä¼ é€’è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li>é¦–å…ˆå°† Client ç«¯å¹³å°çš„æ•°æ®è¿›è¡Œç¼–ç ï¼Œç„¶åé€šè¿‡ PlatformChannel å‘é€</li>
<li>Host ç«¯æ¥å—åˆ°æ¶ˆæ¯åï¼Œå°†æ¶ˆæ¯è§£ç æˆHostç«¯å¹³å°çš„æ•°æ®ç±»å‹</li>
<li>Host ç«¯å‘ Client ç«¯å‘é€å›åº”çš„æ¶ˆæ¯ï¼ŒåŒæ ·è¦å…ˆè¿›è¡Œç¼–ç åï¼Œæ‰èƒ½å‘é€</li>
<li>Client ç«¯æ¥æ”¶åˆ°æ¶ˆæ¯åï¼Œå°†æ¶ˆæ¯è§£ç æˆ Client ç«¯å¹³å°çš„æ•°æ®ç±»å‹</li>
</ul>
<p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œç¼–è§£ç çš„æ–¹æ³•å°±å« <code>codec</code>ã€‚æ¯ä¸€ä¸ª PlatformChannel éƒ½æœ‰ä¸€ä¸ª codecã€‚</p>
<p>ä¸‹é¢æ˜¯æ¯ç§ PlatformChannel ä½¿ç”¨çš„ codecï¼š</p>
<table>
<thead>
<tr>
<th></th>
<th>MethodChannel</th>
<th>EventChannel</th>
<th>BasicMessageChannel</th>
</tr>
</thead>
<tbody>
<tr>
<td>codec</td>
<td>StandartMethodCodec</td>
<td>StandartMethodCodec</td>
<td>MessageCodec çš„å®ç°ç±»ï¼Œéœ€è¦è‡ªå·±è®¾ç½®ï¼ŒåŒ…æ‹¬ä¸Šé¢çš„å››ä¸ªå’Œè‡ªå·±çš„å®ç°éƒ½è¡Œ</td>
</tr>
</tbody>
</table>
<p>PlatformChannel çš„ codec ä¸»è¦åˆ†ä¸ºä¸¤ç±»ï¼š</p>
<ol>
<li>
<p>MethodCodec</p>
<p>MethodCodec æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ƒçš„å®ç°ç±»æ˜¯å¦‚ä¸‹çš„ä¸¤ä¸ªï¼š</p>
<ul>
<li>StandartMethodCodecï¼šå¯ä»¥ç¼–è§£ç  PlatformChannel æ”¯æŒçš„æ‰€æœ‰ç±»å‹çš„æ•°æ®</li>
<li>JSONMethodCodecï¼šåªå¯ä»¥ç¼–è§£ç  JSON ç±»å‹çš„æ•°æ®</li>
</ul>
</li>
<li>
<p>MessageCodec</p>
<p>MessageCodec æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ƒçš„å®ç°ç±»æ˜¯å¦‚ä¸‹çš„å››ä¸ªï¼š</p>
<ul>
<li>StandardMessageCodecï¼šå¯ä»¥ç¼–è§£ç  PlatformChannel æ”¯æŒçš„æ‰€æœ‰ç±»å‹çš„æ•°æ®</li>
<li>BinaryCodecï¼šåªå¯ä»¥ç¼–è§£ç  byte ç±»å‹çš„æ•°æ®</li>
<li>StringCodecï¼šåªå¯ä»¥ç¼–è§£ç  String ç±»å‹çš„æ•°æ®</li>
<li>JSONMessageCodecï¼šåªå¯ä»¥ç¼–è§£ç  JSON ç±»å‹çš„æ•°æ®</li>
</ul>
</li>
</ol>
<h3 class="heading" data-id="heading-5">PlatformChannel æ”¯æŒçš„æ•°æ®ç±»å‹</h3>
<p>ä¸‹å›¾æ˜¯PlatformChannelæ”¯æŒçš„æ•°æ®ç±»å‹ï¼Œä»¥åŠåœ¨ Flutterã€Androidã€iOS ä¸‰ä¸ªå¹³å°ä¸Šè½¬åŒ–çš„å¯¹åº”å…³ç³»ï¼š</p>
<table>
<thead>
<tr>
<th>Flutter</th>
<th>Android</th>
<th>iOS</th>
</tr>
</thead>
<tbody>
<tr>
<td>null</td>
<td>null</td>
<td>nil (NSNull when nested)</td>
</tr>
<tr>
<td>bool</td>
<td>java.lang.Boolean</td>
<td>NSNumber numberWithBool:</td>
</tr>
<tr>
<td>int</td>
<td>java.lang.Integer</td>
<td>NSNumber numberWithInt:</td>
</tr>
<tr>
<td>int, if 32 bits not enough</td>
<td>java.lang.Long</td>
<td>NSNumber numberWithLong:</td>
</tr>
<tr>
<td>double</td>
<td>java.lang.Double</td>
<td>NSNumber numberWithDouble:</td>
</tr>
<tr>
<td>String</td>
<td>java.lang.String</td>
<td>NSString</td>
</tr>
<tr>
<td>Uint8List</td>
<td>byte[]</td>
<td>FlutterStandardTypedData typedDataWithBytes:</td>
</tr>
<tr>
<td>Int32List</td>
<td>int[]</td>
<td>FlutterStandardTypedData typedDataWithInt32:</td>
</tr>
<tr>
<td>Int64List</td>
<td>long[]</td>
<td>FlutterStandardTypedData typedDataWithInt64:</td>
</tr>
<tr>
<td>Float64List</td>
<td>double[]</td>
<td>FlutterStandardTypedData typedDataWithFloat64:</td>
</tr>
<tr>
<td>List</td>
<td>java.util.ArrayList</td>
<td>NSArray</td>
</tr>
<tr>
<td>Map</td>
<td>java.util.HashMap</td>
<td>NSDictionary</td>
</tr>
</tbody>
</table>
<h2 class="heading" data-id="heading-6">PlatformChannel -- MethodChannel çš„ä½¿ç”¨</h2>
<p>æœ¬èŠ‚è®²ä¸€ä¸‹ MethodChannel çš„ä½¿ç”¨æ–¹æ³•ã€‚MethodChannel æ—¢å¯ä»¥è®© Flutter è°ƒç”¨ Androidï¼Œä¹Ÿå¯ä»¥è®© Android è°ƒç”¨ Flutterã€‚</p>
<p>è¿™é‡Œå†™ä¸¤ä¸ªä¾‹å­ï¼Œä¸€ä¸ªæ˜¯ Flutter è°ƒç”¨ Android åŠŸèƒ½çš„ä¾‹å­ï¼Œå¦ä¸€ä¸ªæ˜¯ Android
è°ƒç”¨ Flutter åŠŸèƒ½çš„ä¾‹å­ã€‚</p>
<blockquote class="warning"><p>PlatformChannel æ¶‰åŠåˆ°ç¼–å†™ Native ä»£ç ï¼Œæ‰€ä»¥é™¤äº† VS Codeï¼Œè¿˜éœ€è¦ä½¿ç”¨ Android Studio å’Œ Xcodeã€‚
</p></blockquote><h3 class="heading" data-id="heading-7">Flutter è°ƒç”¨ Android åŠŸèƒ½</h3>
<p>ä½¿ç”¨ Flutter å¼¹ä¸€ä¸ª Android çš„ Toastã€‚</p>
<p>ä¸ºäº†å®ç°è¿™ä¸€æ ·åŠŸèƒ½ï¼Œéœ€è¦ä½¿ç”¨ Flutter è°ƒç”¨ Android çš„åŠŸèƒ½ï¼Œé‚£ä¹ˆè¿™é‡Œ Flutter æ˜¯ Clientï¼ŒAndroid æ˜¯ Hostã€‚</p>
<p>éœ€è¦åœ¨ Androidç«¯ ä¸Šå®ç°ç›‘å¬åŠåŠŸèƒ½ï¼Œç„¶ååœ¨ Flutterç«¯ è°ƒç”¨ã€‚</p>
<h4 class="heading" data-id="heading-8">åœ¨ Android ç«¯æ·»åŠ ç›‘å¬åŠå®ç°åŠŸèƒ½ï¼š</h4>
<p>Android ç«¯æ˜¯ Hostï¼Œåœ¨ Android çš„ä»£ç é‡Œæ‰¾åˆ° <code>MainActivity.java</code> ,ç„¶ååœ¨ <code>OnCreate()</code> é‡Œä½¿ç”¨ <code>MethodChannel</code> æ·»åŠ ç›‘å¬ï¼š</p>
<pre><code class="hljs bash" lang="bash">  @Override
  protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    GeneratedPluginRegistrant.registerWith(this);

    new MethodChannel(getFlutterView(),<span class="hljs-string">"samples.flutter.io/toast"</span>).setMethodCallHandler(new MethodChannel.<span class="hljs-function"><span class="hljs-title">MethodCallHandler</span></span>() {
      @Override
      public void onMethodCall(MethodCall methodCall, MethodChannel.Result result) {
        
      }
    });
  }    
</code></pre><p>è¿™é‡Œ <code>new MethodChannel</code> çš„å®ä¾‹ï¼Œéœ€è¦ä¸¤ä¸ªå‚æ•°ï¼š</p>
<ol>
<li>
<p>ç¬¬ä¸€ä¸ªæ˜¯ BinaryMessenger</p>
<p>è¿™é‡Œç”¨çš„æ˜¯ FlutterViewï¼Œå› ä¸º FlutterView å®ç°äº† BinaryMessenger çš„æ¥å£ï¼Œåœ¨ MainActivity é‡Œé€šè¿‡ getFlutterView() è·å–</p>
</li>
<li>
<p>ç¬¬äºŒä¸ªæ˜¯ String</p>
<p>æ˜¯ Channel Nameï¼Œç”¨äºæ ‡è¯†ä¸åŒçš„ MethodChannelï¼Œè¿™ä¸ªå€¼å¯ä»¥éšä¾¿å–ï¼Œä½†æ¯ä¸ª MethodChannel éƒ½å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œä¸€èˆ¬å–å€¼æ˜¯ï¼šåŒ…å+"/"+åŠŸèƒ½ï¼Œè¿™ä¸ªå€¼åœ¨ Flutter ä¸­ä¹Ÿè¦ç”¨ï¼ŒFlutter æ­£æ˜¯é€šè¿‡è¿™ä¸ªæ¥åŒºåˆ†ä¸åŒçš„ MethodChannel çš„ã€‚åœ¨ demo é‡Œæˆ‘å–çš„å€¼æ˜¯ <code>samples.flutter.io/toast</code>ã€‚</p>
</li>
</ol>
<p>åˆ›å»ºå®Œ <code>MethodChannel</code> çš„å®ä¾‹åï¼Œè¿˜éœ€è¦æ·»åŠ ç›‘å¬ï¼Œæ˜¯é€šè¿‡ <code>MethodChannel</code> çš„ <code>setMethodCallHandler</code> æ¥æ·»åŠ ç›‘å¬çš„ã€‚</p>
<p>ç›‘å¬ç›‘å¬å®Œåï¼Œåœ¨çœ‹å›è°ƒé‡Œçš„ä¸¤ä¸ªå‚æ•°ï¼š</p>
<ol>
<li>
<p>MethodCall</p>
<p>ä» Flutter ç«¯ä¼ é€æ¥çš„æ•°æ®ã€‚</p>
<p>MethodCall é‡Œæœ‰å¦‚ä¸‹çš„å‡ ä¸ªæ–¹æ³•ï¼Œç”¨æ¥è·å–ä» Flutter ç«¯ä¼ é€æ¥çš„æ•°æ®ï¼š</p>
<ul>
<li>
<p>methodCall.methodï¼š</p>
<p>methodCall çš„å±æ€§ï¼Œè·å–æ–¹æ³•åï¼Œç”¨äºæ ‡è¯† Flutter æƒ³è°ƒç”¨ Android çš„å“ªä¸ªæ–¹æ³•ï¼Œè¿™é‡Œ method åªèƒ½æ˜¯ String ç±»å‹ï¼Œè¿™å°±è¦æ±‚ Flutter åªèƒ½ä¼  String</p>
</li>
<li>
<p>methodCall.arguments</p>
<p>methodCall çš„å±æ€§ï¼Œè·å–å…·ä½“çš„å‚æ•°ï¼Œè¿™é‡Œ arguments åªèƒ½æ˜¯ Map ç±»å‹æˆ–è€… JSONObject ç±»å‹ï¼Œè¿™å°±è¦æ±‚ Flutter åªèƒ½ä¼ è¿™ä¸¤ç§ç±»å‹çš„æ•°æ®</p>
</li>
<li>
<p>methodCall.argument(String key)</p>
<p>methodCall çš„æ–¹æ³•ï¼Œè·å– Key ä¸ºç‰¹å®šå€¼çš„å‚æ•°çš„å€¼</p>
</li>
</ul>
</li>
<li>
<p>MethodChannel.Result</p>
<p>Android å‘ Flutter ç«¯å‘é€æ•°æ®</p>
<p>Android ç«¯å¤„ç†å®Œä» Flutter ç«¯ä¼ æ¥çš„æ•°æ®åï¼Œå°±éœ€è¦å‘ Flutter ç«¯å‘é€æ•°æ®ï¼Œä½¿ç”¨å¦‚ä¸‹çš„æ–¹æ³•ï¼š</p>
<ul>
<li>
<p>result.success(Object result)</p>
<p>å¦‚æœè¿è¡ŒæˆåŠŸï¼Œä½¿ç”¨è¿™ä¸ªæ–¹æ³•ï¼ŒåŒæ—¶å°† result è¿”å›ç»™ Flutter,è¯·æ³¨æ„ï¼Œresult åªèƒ½æ˜¯ PlatformChannel æ”¯æŒçš„æ•°æ®ç±»å‹</p>
</li>
<li>
<p>result.error(String errorCode,String errorMsg,Object errorDetails)</p>
<p>å¦‚æœè¿è¡Œå¤±è´¥ï¼Œä½¿ç”¨è¿™ä¸ªæ–¹æ³•,å¸¦å…¥ errorCodeã€errorMsg è¿˜æœ‰ errorDetails çš„å‚æ•°ï¼ŒerrorDetails åªèƒ½æ˜¯ PlatformChannel æ”¯æŒçš„æ•°æ®ç±»å‹</p>
</li>
<li>
<p>result.notImplemented()</p>
<p>å¦‚æœ Flutter æƒ³è°ƒç”¨çš„æ–¹æ³•,Android æ²¡æœ‰å®ç°ï¼Œä½¿ç”¨è¿™ä¸ªæ–¹æ³•ã€‚ä¼šå°† notImplemented è¿”å›ç»™ Flutterã€‚</p>
</li>
</ul>
</li>
</ol>
<p>ä¸‹é¢æ˜¯ MainActivity.java é‡Œçš„ä»£ç ï¼š</p>
<pre><code class="hljs bash" lang="bash">    package com.kk.flutter_app;

    import android.os.Bundle;
    import android.widget.Toast;
    
    import io.flutter.app.FlutterActivity;
    import io.flutter.plugin.common.MethodCall;
    import io.flutter.plugin.common.MethodChannel;
    import io.flutter.plugins.GeneratedPluginRegistrant;
    
    public class MainActivity extends FlutterActivity {
      @Override
      protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        GeneratedPluginRegistrant.registerWith(this);
    
        new MethodChannel(getFlutterView(),<span class="hljs-string">"samples.flutter.io/toast"</span>).setMethodCallHandler(new MethodChannel.<span class="hljs-function"><span class="hljs-title">MethodCallHandler</span></span>() {
          @Override
          public void onMethodCall(MethodCall methodCall, MethodChannel.Result result) {
            <span class="hljs-keyword">if</span>(<span class="hljs-string">"toast"</span>.equals(methodCall.method)){
              <span class="hljs-keyword">if</span>(methodCall.hasArgument(<span class="hljs-string">"content"</span>)){
                Toast.makeText(getBaseContext(), methodCall.argument(<span class="hljs-string">"content"</span>),Toast.LENGTH_SHORT).show();
                result.success(<span class="hljs-string">"success"</span>);
              }<span class="hljs-keyword">else</span> {
                result.error(<span class="hljs-string">"-1"</span>,<span class="hljs-string">"toast fail"</span>,<span class="hljs-string">"content is null"</span>);
              }
            }<span class="hljs-keyword">else</span> {
              result.notImplemented();
            }
          }
        });
      }
    }

</code></pre><p>ä½¿ç”¨ <code>methodCall.method</code> çš„å€¼æ¥åŒºåˆ†è°ƒç”¨å“ªä¸ªæ–¹æ³•ã€‚</p>
<p>å¦‚æœè°ƒç”¨çš„æ–¹æ³•åæ˜¯ toastï¼Œåˆ™å¼¹ Toastã€‚</p>
<h4 class="heading" data-id="heading-9">åœ¨ Flutter ç«¯å‘é€æ¶ˆæ¯ï¼š</h4>
<p>Flutter ç«¯æ˜¯ Clientï¼Œé¦–å…ˆä¹Ÿè¦åˆ›å»ºä¸€ä¸ª MethodChannel çš„å®ä¾‹ï¼š</p>
<pre><code class="hljs bash" lang="bash">static const platformChannel = const MethodChannel(<span class="hljs-string">'samples.flutter.io/toast'</span>);
</code></pre><p>åˆ›å»º MethodChannel å®ä¾‹çš„æ—¶å€™ï¼Œè¦ä¼ å…¥ ChannelNameï¼ŒChannelName å¿…é¡»è¦å’Œ Android çš„ ChannelName ä¿æŒä¸€è‡´ã€‚ChannelName ç”¨äºåŒºåˆ†è°ƒç”¨å“ªä¸ªæ–¹æ³•ã€‚</p>
<p>ç„¶åè°ƒç”¨æ¥å£ï¼š</p>
<pre><code class="hljs bash" lang="bash">    void showToast(String content) async {
        var arguments = Map();
        arguments[<span class="hljs-string">'content'</span>] = content;

        try {
          String result = await platformChannel.invokeMethod(<span class="hljs-string">'toast'</span>, arguments);
          //success
          <span class="hljs-built_in">print</span>(<span class="hljs-string">'showToast '</span>+ result);
        } on PlatformException catch (e) {
          //error
          <span class="hljs-built_in">print</span>(<span class="hljs-string">'showToast '</span> + e.code + e.message + e.details);
        } on MissingPluginException catch (e){
          //notImplemented
          <span class="hljs-built_in">print</span>(<span class="hljs-string">'showToast '</span> + e.message);
        }
    }
</code></pre><ul>
<li><code>platformChannel.invokeMethod('toast', arguments)</code> æ˜¯è°ƒç”¨Androidçš„æ–¹æ³•ï¼Œ</li>
<li><code>toast</code> æ˜¯è¦è°ƒç”¨çš„æ–¹æ³•åï¼Œä¸ºStringç±»å‹ï¼›</li>
<li><code>arguments</code> æ˜¯å‚æ•°ï¼Œåªèƒ½æ˜¯Mapæˆ–è€…JSONç±»å‹ï¼Œè¿™é‡Œæ˜¯Mapç±»å‹ã€‚</li>
</ul>
<blockquote class="warning"><p>ä¸ºäº†ä¸é˜»å¡ UIï¼ŒPlatformChannel ä½¿ç”¨ async å’Œ await æ¥ä¿®é¥°ï¼Œè€Œä¸”å¿…é¡»è¦ç”¨ try catchã€‚å‰é¢çŸ¥é“æœ‰ä¸‰ç§è¿”å›ç»“æœï¼šsuccessã€error
ã€notImplementedï¼Œç¬¬ä¸€ä¸ª catch çš„ PlatformException å°±æ˜¯ error çš„ç»“æœï¼Œç¬¬äºŒä¸ª catch çš„ MissingPluginException å°±æ˜¯ notImplemented çš„ç»“æœã€‚
</p></blockquote><p>Flutter çš„ä»£ç æ˜¯ï¼š</p>
<pre><code class="hljs bash" lang="bash">    import <span class="hljs-string">'package:flutter/material.dart'</span>;
    import <span class="hljs-string">'package:flutter/services.dart'</span>;
    
    void main() =&gt; runApp(MyApp());
    
    class MyApp extends StatelessWidget {
      static const platformChannel =
          const MethodChannel(<span class="hljs-string">'samples.flutter.io/toast'</span>);
    
      @override
      Widget build(BuildContext context) {
        <span class="hljs-built_in">return</span> MaterialApp(
          title: <span class="hljs-string">"Flutter Demo"</span>,
          theme: ThemeData(
            primaryColor: Colors.blue,
          ),
          home: Scaffold(
              appBar: AppBar(title: Text(<span class="hljs-string">"Platform Channel"</span>)),
              body: RaisedButton(
                  child: Text(<span class="hljs-string">"Show Toast"</span>),
                  onPressed: () {
                    showToast(<span class="hljs-string">"Flutter Toast"</span>);
                  })),
        );
      }
    
      void showToast(String content) async {
        var arguments = Map();
        arguments[<span class="hljs-string">'content'</span>] = content;
    
        try {
          String result = await platformChannel.invokeMethod(<span class="hljs-string">'toast'</span>, arguments);
          <span class="hljs-built_in">print</span>(<span class="hljs-string">'showToast '</span>+ result);
        } on PlatformException catch (e) {
          <span class="hljs-built_in">print</span>(<span class="hljs-string">'showToast '</span> + e.code + e.message + e.details);
        } on MissingPluginException catch (e){
          <span class="hljs-built_in">print</span>(<span class="hljs-string">'showToast '</span> + e.message);
        }
      }
    }

</code></pre><p>ä¸‹é¢æ˜¯è¿è¡Œçš„æ•ˆæœï¼š
</p><figure><img class="lazyload inited" data-src="https://user-gold-cdn.xitu.io/2019/4/9/16a003a96325707f?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" data-width="357" data-height="736" src="data:image/svg+xml;utf8,<?xml version=&quot;1.0&quot;?><svg xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot; width=&quot;357&quot; height=&quot;736&quot;></svg>"><figcaption></figcaption></figure><p></p>
<h3 class="heading" data-id="heading-10">Android è°ƒç”¨ Flutter åŠŸèƒ½</h3>
<p>Android å‘é€ä¸€æ®µæ–‡å­—åˆ° Flutterï¼Œå¹¶æ˜¾ç¤ºåœ¨ Flutter çš„ UI ä¸Šï¼šåŸæœ¬Flutter UIä¸Šæ˜¾ç¤ºçš„æ˜¯<code>Flutter Message</code>ï¼Œç„¶åå°†APPé€€åå°ï¼Œåœ¨åˆ‡åˆ°å‰å°ï¼ŒAndroidå‘Flutterå‘é€æ•°æ®ï¼Œå°†UIçš„æ˜¾ç¤ºå˜ä¸º<code>Android Message</code>ã€‚</p>
<p>ä¸ºäº†å®ç°è¿™ä¸€åŠŸèƒ½ï¼Œå°±éœ€è¦ Android è°ƒç”¨ Flutter çš„åŠŸèƒ½ï¼Œ
è¿™æ—¶ Android æ˜¯ Clientï¼Œè€Œ Flutter æ˜¯ Hostã€‚</p>
<p>æ‰€ä»¥è¦åœ¨ Flutter ä¸Šå®ç°ç›‘å¬å’ŒåŠŸèƒ½ï¼Œç„¶ååœ¨ Android ä¸­ä½¿ç”¨ã€‚</p>
<h4 class="heading" data-id="heading-11">åœ¨Flutterç«¯æ·»åŠ ç›‘å¬åŠå®ç°åŠŸèƒ½ï¼š</h4>
<pre><code class="hljs bash" lang="bash">    class MyAppState extends State&lt;MyApp&gt; {
      static const platformChannel =
          const MethodChannel(<span class="hljs-string">'samples.flutter.io/message'</span>);
    
      String textContent = <span class="hljs-string">'Flutter Message'</span>;
    
      @override
      void <span class="hljs-function"><span class="hljs-title">initState</span></span>() {
        // TODO: implement initState
        super.initState();
        platformChannel.setMethodCallHandler((methodCall) async {
          switch (methodCall.method) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">'showText'</span>:
              String content = await methodCall.arguments[<span class="hljs-string">'content'</span>];
              <span class="hljs-keyword">if</span> (content !=null &amp;&amp; content.isNotEmpty) {
                <span class="hljs-built_in">set</span>State(() {
                  textContent = content;
                });
                //è¿”å›æˆåŠŸçš„ç»“æœ
                <span class="hljs-built_in">return</span> <span class="hljs-string">'success'</span>;
              } <span class="hljs-keyword">else</span> {
                //è¿”å›å¤±è´¥çš„ç»“æœ
                throw PlatformException(
                    code: <span class="hljs-string">'-1'</span>,
                    message: <span class="hljs-string">'showText fail'</span>,
                    details: <span class="hljs-string">'content is null'</span>);
              }
              <span class="hljs-built_in">break</span>;
            default:
              //è¿”å›æ–¹æ³•æœªå®ç°çš„ç»“æœ
              throw MissingPluginException();
          }
        });
      }
    
      @override
      Widget build(BuildContext context) {
        // TODO: implement build
        <span class="hljs-built_in">return</span> ...
      }
    }
</code></pre><p>é¦–å…ˆåˆ›å»º MethodChannel çš„å®ä¾‹ï¼š</p>
<pre><code class="hljs bash" lang="bash">static const platformChannel = const MethodChannel(<span class="hljs-string">'samples.flutter.io/message'</span>);
</code></pre><p>æ ¹æ®å‰é¢è®²çš„ StatefulWidget çš„ç”Ÿå‘½å‘¨æœŸï¼Œæˆ‘ä»¬åœ¨ initState é‡Œæ·»åŠ  MethodChannel çš„ç›‘å¬ï¼Œå°±æ˜¯é€šè¿‡ setMethodCallHandlerï¼Œä¸º MethodChannel æ·»åŠ å›è°ƒï¼Œå›è°ƒçš„æ–¹å¼æ·»åŠ äº† asyncï¼Œå› æ­¤ä¸ä¼šé˜»å¡ UIï¼š</p>
<pre><code class="hljs bash" lang="bash">    platformChannel.setMethodCallHandler((methodCall) async {
      switch (methodCall.method) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">'showText'</span>:
          String content = await methodCall.arguments[<span class="hljs-string">'content'</span>];
          <span class="hljs-keyword">if</span> (content !=null &amp;&amp; content.isNotEmpty) {
            ...
            <span class="hljs-built_in">return</span> <span class="hljs-string">'success'</span>;
          } <span class="hljs-keyword">else</span> {
            throw PlatformException(
                code: <span class="hljs-string">'-1'</span>,
                message: <span class="hljs-string">'showText fail'</span>,
                details: <span class="hljs-string">'content is null'</span>);
          }
          <span class="hljs-built_in">break</span>;
        default:
          throw MissingPluginException();
      }
    });
</code></pre><p>å›è°ƒé‡Œæœ‰ä¸ªå‚æ•° <code>methodCall</code>ï¼Œå’Œ Android é‡Œçš„ <code>methodCall</code> æœ‰ç›¸åŒçš„å±æ€§ï¼š</p>
<ul>
<li>methodCall.methodï¼š è·å–æ–¹æ³•åï¼ŒString ç±»å‹</li>
<li>methodCall.argumentsï¼šè·å–å…·ä½“çš„å‚æ•°ï¼Œarguments åªèƒ½æ˜¯ Map ç±»å‹æˆ–è€… JSONObject ç±»å‹</li>
</ul>
<p>åœ¨è¿”å›ç»“æœçš„æ—¶å€™ï¼š</p>
<ul>
<li>å¦‚æœè¿è¡ŒæˆåŠŸï¼Œåˆ™ç›´æ¥ <code>return Object</code></li>
<li>å¦‚æœå…è®¸å¤±è´¥ï¼Œåˆ™ throw ä¸€ä¸ª PlatformException,è¡¨ç¤ºè¿è¡Œå¤±è´¥</li>
<li>å¦‚æœæ–¹æ³•æ²¡æœ‰å®ç°ï¼Œåˆ™ throw ä¸€ä¸ª MissingPluginException</li>
</ul>
<p>Flutteréƒ¨åˆ†çš„å…¨éƒ¨ä»£ç ä¸ºï¼š</p>
<pre><code class="hljs bash" lang="bash">    import <span class="hljs-string">'package:flutter/material.dart'</span>;
    import <span class="hljs-string">'package:flutter/services.dart'</span>;
    
    void main() =&gt; runApp(MyApp());
    
    class MyApp extends StatefulWidget {
      @override
      State&lt;StatefulWidget&gt; <span class="hljs-function"><span class="hljs-title">createState</span></span>() {
        // TODO: implement createState
        <span class="hljs-built_in">return</span> MyAppState();
      }
    }
    
    class MyAppState extends State&lt;MyApp&gt; {
      static const platformChannel =
          const MethodChannel(<span class="hljs-string">'samples.flutter.io/message'</span>);
    
      String textContent = <span class="hljs-string">'Flutter Message'</span>;
    
      @override
      void <span class="hljs-function"><span class="hljs-title">initState</span></span>() {
        // TODO: implement initState
        super.initState();
        platformChannel.setMethodCallHandler((methodCall) async {
          switch (methodCall.method) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">'showText'</span>:
              String content = await methodCall.arguments[<span class="hljs-string">'content'</span>];
              <span class="hljs-keyword">if</span> (content !=null &amp;&amp; content.isNotEmpty) {
                <span class="hljs-built_in">set</span>State(() {
                  textContent = content;
                });
                <span class="hljs-built_in">return</span> <span class="hljs-string">'success'</span>;
              } <span class="hljs-keyword">else</span> {
                throw PlatformException(
                    code: <span class="hljs-string">'-1'</span>,
                    message: <span class="hljs-string">'showText fail'</span>,
                    details: <span class="hljs-string">'content is null'</span>);
              }
              <span class="hljs-built_in">break</span>;
            default:
              throw MissingPluginException();
          }
        });
      }
    
      @override
      Widget build(BuildContext context) {
        // TODO: implement build
        <span class="hljs-built_in">return</span> MaterialApp(
          title: <span class="hljs-string">"Flutter Demo"</span>,
          theme: ThemeData(
            primaryColor: Colors.blue,
          ),
          home: Scaffold(
            appBar: AppBar(
              title: Text(<span class="hljs-string">'Platform Channel'</span>),
            ),
            body: Text(textContent),
          ),
        );
      }
    }

</code></pre><p>å¹¶ä¸”å®ç°äº†åœ¨ Flutter ç«¯æ›´æ–° UI çš„åŠŸèƒ½ã€‚</p>
<h4 class="heading" data-id="heading-12">åœ¨ Android ç«¯å‘é€æ•°æ®</h4>
<p>å‘é€æ•°æ®æˆ‘å†™åœ¨ <code>onResume</code> é‡Œé¢ï¼Œå½“ APP é€€åå°ï¼Œåœ¨åˆ‡åˆ°å‰å°æ—¶å°±ä¼šè§¦å‘ã€‚</p>
<p>Android ç«¯çš„ä»£ç è¿˜æ˜¯åœ¨ MainActivity.java é‡Œï¼š</p>
<pre><code class="hljs bash" lang="bash">package com.kk.flutter_app;

import android.os.Bundle;
import android.util.Log;

import java.util.HashMap;
import java.util.Map;

import io.flutter.app.FlutterActivity;
import io.flutter.plugin.common.MethodChannel;
import io.flutter.plugins.GeneratedPluginRegistrant;

public class MainActivity extends FlutterActivity {

  MethodChannel methodChannel;
  @Override
  protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    GeneratedPluginRegistrant.registerWith(this);

    methodChannel = new MethodChannel(getFlutterView(),<span class="hljs-string">"samples.flutter.io/message"</span>);

  }

  @Override
  protected void <span class="hljs-function"><span class="hljs-title">onResume</span></span>() {
    super.onResume();
    Map map = new HashMap();
    map.put(<span class="hljs-string">"content"</span>,<span class="hljs-string">"Android Message"</span>);
    methodChannel.invokeMethod(<span class="hljs-string">"showText"</span>, map, new MethodChannel.<span class="hljs-function"><span class="hljs-title">Result</span></span>() {
      @Override
      public void success(Object o) {
        Log.d(<span class="hljs-string">"MainActivity"</span>,(String)o);
      }

      @Override
      public void error(String errorCode, String errorMsg, Object errorDetail) {
        Log.d(<span class="hljs-string">"MainActivity"</span>,<span class="hljs-string">"errorCode:"</span>+errorCode+<span class="hljs-string">" errorMsg:"</span>+errorMsg+<span class="hljs-string">" errorDetail:"</span>+(String)errorDetail);
      }

      @Override
      public void <span class="hljs-function"><span class="hljs-title">notImplemented</span></span>() {
        Log.d(<span class="hljs-string">"MainActivity"</span>,<span class="hljs-string">"notImplemented"</span>);
      }
    });
  }
}

</code></pre><p>é¦–å…ˆä¹Ÿæ˜¯å…ˆåˆ›å»º MethodChannel çš„å®ä¾‹ï¼š</p>
<pre><code class="hljs bash" lang="bash">methodChannel = new MethodChannel(getFlutterView(),<span class="hljs-string">"samples.flutter.io/message"</span>);
</code></pre><p>ç„¶åå‘ Flutter å‘é€æ¶ˆæ¯ï¼Œå‘Šè¯‰ Flutter è¦è°ƒç”¨å“ªä¸ªæ–¹æ³•ï¼š</p>
<pre><code class="hljs bash" lang="bash">methodChannel.invokeMethod(<span class="hljs-string">"showText"</span>, map, new MethodChannel.<span class="hljs-function"><span class="hljs-title">Result</span></span>() {
      @Override
      public void success(Object o) {
        Log.d(<span class="hljs-string">"MainActivity"</span>,(String)o);
      }

      @Override
      public void error(String errorCode, String errorMsg, Object errorDetail) {
        Log.d(<span class="hljs-string">"MainActivity"</span>,<span class="hljs-string">"errorCode:"</span>+errorCode+<span class="hljs-string">" errorMsg:"</span>+errorMsg+<span class="hljs-string">" errorDetail:"</span>+(String)errorDetail);
      }

      @Override
      public void <span class="hljs-function"><span class="hljs-title">notImplemented</span></span>() {
        Log.d(<span class="hljs-string">"MainActivity"</span>,<span class="hljs-string">"notImplemented"</span>);
      }
    });
  }
</code></pre><p>åœ¨ <code>MethodChannel.Result()</code> å›è°ƒé‡Œæœ‰ä¸‰ä¸ªæ–¹æ³•ï¼š</p>
<ul>
<li>successï¼šè¡¨ç¤ºè°ƒç”¨æˆåŠŸ</li>
<li>errorï¼šè¡¨ç¤ºè°ƒç”¨å¤±è´¥</li>
<li>notImplementedï¼šè¡¨ç¤ºæ²¡æœ‰æ­¤æ–¹æ³•</li>
</ul>
<p>åˆšè¿è¡Œ APP çš„æ•ˆæœï¼š</p>
<p></p><figure><img class="lazyload inited" data-src="https://user-gold-cdn.xitu.io/2019/4/9/16a003cd794b9205?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" data-width="413" data-height="768" src="data:image/svg+xml;utf8,<?xml version=&quot;1.0&quot;?><svg xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot; width=&quot;413&quot; height=&quot;768&quot;></svg>"><figcaption></figcaption></figure><p></p>
<p>é€€åå°ï¼Œåˆåˆ‡åˆ°å‰å°çš„æ•ˆæœï¼š</p>
<p></p><figure><img class="lazyload inited" data-src="https://user-gold-cdn.xitu.io/2019/4/9/16a003d0d80d37e3?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" data-width="425" data-height="768" src="data:image/svg+xml;utf8,<?xml version=&quot;1.0&quot;?><svg xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot; width=&quot;425&quot; height=&quot;768&quot;></svg>"><figcaption></figcaption></figure><p></p>
<h2 class="heading" data-id="heading-13">PlatformChannel -- EventChannel çš„ä½¿ç”¨</h2>
<p>æœ¬èŠ‚è®²ä¸€ä¸‹ EventChannel ä½¿ç”¨çš„ä½¿ç”¨æ–¹æ³•ã€‚EventChannel åªèƒ½ä» Android å‘ Flutter å‘é€æ•°æ®ï¼Œå®ƒçš„ä½¿ç”¨æ–¹å¼å¾ˆåƒæˆ‘ä»¬ç†Ÿæ‚‰çš„ Event çš„ä½¿ç”¨æ–¹å¼ã€‚</p>
<p>è¿™é‡Œä½¿ç”¨ EventChannel å®ç°ä¸€ä¸ªå’Œä¸ŠèŠ‚ç›¸åŒçš„ä¾‹å­ï¼š</p>
<p>Android å‘é€ä¸€æ®µæ–‡å­—åˆ° Flutterï¼Œå¹¶æ˜¾ç¤ºåœ¨ Flutter çš„ UI ä¸Šï¼šåŸæœ¬Flutter UIä¸Šæ˜¾ç¤ºçš„æ˜¯<code>Flutter Message</code>ï¼Œç„¶åå°†APPé€€åå°ï¼Œåœ¨åˆ‡åˆ°å‰å°ï¼ŒAndroidå‘Flutterå‘é€æ•°æ®ï¼Œå°†UIçš„æ˜¾ç¤ºå˜ä¸º<code>Android Message</code>ã€‚</p>
<h3 class="heading" data-id="heading-14">åœ¨ Flutter ç«¯æ·»åŠ ç›‘å¬å¹¶å®ç°åŠŸèƒ½</h3>
<p>é¦–å…ˆæ˜¯åˆ›å»º EventChannelï¼š</p>
<pre><code class="hljs bash" lang="bash">static const eventChannel =
      const EventChannel(<span class="hljs-string">'samples.flutter.io/event'</span>);
</code></pre><p>åˆ›å»ºæ–¹å¼å’Œ MethodChannel æ˜¯ä¸€æ ·çš„ï¼Œéƒ½éœ€è¦ä¼ å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚</p>
<p>ç„¶ååœ¨ initState() é‡Œä½¿ç”¨ eventChannel çš„ listen æ–¹æ³•æ·»åŠ ç›‘å¬ï¼š</p>
<pre><code class="hljs bash" lang="bash">eventChannel.receiveBroadcastStream().listen(_onListen,onError: _onError,onDone: _onDone,cancelOnError: <span class="hljs-literal">false</span>);
</code></pre><p>listen æ–¹æ³•å®šä¹‰ä¸ºï¼š</p>
<pre><code class="hljs bash" lang="bash">  StreamSubscription&lt;T&gt; listen(void onData(T event),
      {Function onError, void onDone(), bool cancelOnError});
</code></pre><p>å¯ä»¥çœ‹åˆ° listen æ–¹æ³•æœ‰å¦‚ä¸‹å‡ ä¸ªå‚æ•°ï¼š</p>
<table>
<thead>
<tr>
<th>å‚æ•°åå­—</th>
<th>å‚æ•°ç±»å‹</th>
<th>æ„ä¹‰</th>
<th>å¿…é€‰ or å¯é€‰</th>
</tr>
</thead>
<tbody>
<tr>
<td>onData</td>
<td>void onData(T event)</td>
<td>EventChannel æ­£å¸¸æ”¶åˆ°æ•°æ®çš„äº‹ä»¶</td>
<td>å¿…é€‰</td>
</tr>
<tr>
<td>onError</td>
<td>Function</td>
<td>EventChannel æ”¶åˆ°é”™è¯¯çš„äº‹ä»¶</td>
<td>å¯é€‰</td>
</tr>
<tr>
<td>onDone</td>
<td>void onDone()</td>
<td>EventChannel æ”¶åˆ°ç»“æŸç›‘å¬çš„äº‹ä»¶</td>
<td>å¯é€‰</td>
</tr>
<tr>
<td>cancelOnError</td>
<td>bool</td>
<td>å½“å‡ºé”™çš„æ—¶å€™æ˜¯ä¸æ˜¯è‡ªåŠ¨å–æ¶ˆ<br>é»˜è®¤ä¸ºfalse</td>
<td>å¯é€‰</td>
</tr>
</tbody>
</table>
<pre><code class="hljs bash" lang="bash">import <span class="hljs-string">'package:flutter/material.dart'</span>;
import <span class="hljs-string">'package:flutter/services.dart'</span>;

<span class="hljs-function"><span class="hljs-title">main</span></span>() {
  runApp(new MyApp());
}

class MyApp extends StatefulWidget{
  @override
  State&lt;StatefulWidget&gt; <span class="hljs-function"><span class="hljs-title">createState</span></span>() {
    // TODO: implement createState
    <span class="hljs-built_in">return</span> MyAppState();
  }

}

class MyAppState extends State&lt;MyApp&gt; {
  static const eventChannel =
      const EventChannel(<span class="hljs-string">'samples.flutter.io/event'</span>);

  String textContent = <span class="hljs-string">'Flutter Message'</span>;

  @override
  void <span class="hljs-function"><span class="hljs-title">initState</span></span>() {
    // TODO: implement initState
    super.initState();
    eventChannel.receiveBroadcastStream().listen(_onListen,onError: _onError,onDone: _onDone,cancelOnError: <span class="hljs-literal">false</span>);
  }

  void _onListen(dynamic data){
    <span class="hljs-built_in">set</span>State(() {
      textContent = data;
    });
  }

  void <span class="hljs-function"><span class="hljs-title">_onError</span></span>(){
    <span class="hljs-built_in">set</span>State(() {
      textContent = <span class="hljs-string">'EventChannel error'</span>;
    });
  }

  void <span class="hljs-function"><span class="hljs-title">_onDone</span></span>(){
    <span class="hljs-built_in">set</span>State(() {
      textContent = <span class="hljs-string">'EventChannel done'</span>;
    });
  }

  @override
  Widget build(BuildContext context) {
    // TODO: implement build
    <span class="hljs-built_in">return</span> MaterialApp(
      title: <span class="hljs-string">"Flutter Demo"</span>,
      theme: ThemeData(
        primaryColor: Colors.blue,
      ),
      home: Scaffold(
        appBar: AppBar(
          title: Text(<span class="hljs-string">'Platform Channel -- EventChannel'</span>),
        ),
        body: Text(textContent),
      ),
    );
  }
}
</code></pre><ul>
<li>å¦‚æœè¿è¡Œæ­£å¸¸ï¼Œå°±ä¼šåœ¨ _onListen æ”¶åˆ°æ­£å¸¸æ•°æ®çš„äº‹ä»¶</li>
<li>å¦‚æœè¿è¡Œå‡ºç° error ï¼Œå°±ä¼šåœ¨ _onError æ”¶åˆ°é”™è¯¯çš„äº‹ä»¶</li>
<li>å¦‚æœè¿è¡Œç»“æŸï¼Œå°±ä¼šåœ¨ _onDone æ”¶åˆ°ç»“æŸç›‘å¬çš„äº‹ä»¶</li>
</ul>
<h3 class="heading" data-id="heading-15">åœ¨ Android ç«¯å‘é€æ•°æ®</h3>
<pre><code class="hljs bash" lang="bash">private EventChannel.EventSink mEventSink;
  @Override
  protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    GeneratedPluginRegistrant.registerWith(this);


    new EventChannel(getFlutterView(),<span class="hljs-string">"samples.flutter.io/event"</span>).setStreamHandler(new EventChannel.<span class="hljs-function"><span class="hljs-title">StreamHandler</span></span>() {
      @Override
      public void onListen(Object o, EventChannel.EventSink eventSink) {
        mEventSink = eventSink;
      }

      @Override
      public void onCancel(Object o) {
        mEventSink = null;
      }
    });

  }

  @Override
  protected void <span class="hljs-function"><span class="hljs-title">onResume</span></span>() {
    super.onResume();
    <span class="hljs-keyword">if</span>(mEventSink != null){
      mEventSink.success(<span class="hljs-string">"Android Message"</span>);
    }
  }
</code></pre><p>Android ç«¯é¦–å…ˆæ˜¯åˆ›å»º EventChannel å®ä¾‹ï¼Œè¦ä¿è¯ EventChannel çš„ EventName å’Œ Flutter çš„ä¿æŒä¸€è‡´ï¼ŒåŒæ—¶å®ç° setStreamHandler() æ–¹æ³•ï¼Œè®© Android å’Œ Flutter å»ºç«‹è¿æ¥ï¼Œè€Œä¸”è¦ä¿å­˜ onListen() æ–¹æ³•é‡Œä¼ è¿‡æ¥çš„ EventSink å¯¹è±¡ï¼Œéœ€è¦ç”¨ EventSink å¯¹è±¡æ¥å‘é€æ•°æ®</p>
<p>å‘é€æ•°æ®çš„ä»£ç å°±æ˜¯ï¼š</p>
<ul>
<li>å‘é€æ­£å¸¸æ•°æ®çš„äº‹ä»¶<pre><code class="hljs bash" lang="bash"><span class="hljs-keyword">if</span>(mEventSink != null){
    mEventSink.success(<span class="hljs-string">"Android Message"</span>);
}
</code></pre></li>
<li>å‘é€ error äº‹ä»¶<pre><code class="hljs bash" lang="bash"><span class="hljs-keyword">if</span>(mEventSink != null){
  mEventSink.error(<span class="hljs-string">"-1"</span>,<span class="hljs-string">"EventChannel fail"</span>,<span class="hljs-string">"content is null"</span>);
}
</code></pre></li>
<li>å‘é€ ç»“æŸç›‘å¬çš„äº‹ä»¶<pre><code class="hljs bash" lang="bash"><span class="hljs-keyword">if</span>(mEventSink != null){
  mEventSink.endOfStream();
}
</code></pre></li>
</ul>
<p>Android çš„ MainActivity.java çš„ä»£ç ï¼š</p>
<pre><code class="hljs bash" lang="bash">package com.kk.flutter_app;

import android.os.Bundle;
import io.flutter.app.FlutterActivity;
import io.flutter.plugin.common.EventChannel;
import io.flutter.plugins.GeneratedPluginRegistrant;

public class MainActivity extends FlutterActivity {

  private EventChannel.EventSink mEventSink;
  @Override
  protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    GeneratedPluginRegistrant.registerWith(this);


    new EventChannel(getFlutterView(),<span class="hljs-string">"samples.flutter.io/event"</span>).setStreamHandler(new EventChannel.<span class="hljs-function"><span class="hljs-title">StreamHandler</span></span>() {
      @Override
      public void onListen(Object o, EventChannel.EventSink eventSink) {
        mEventSink = eventSink;
      }

      @Override
      public void onCancel(Object o) {
        mEventSink = null;
      }
    });

  }

  @Override
  protected void <span class="hljs-function"><span class="hljs-title">onResume</span></span>() {
    super.onResume();
    <span class="hljs-keyword">if</span>(mEventSink != null){
      mEventSink.success(<span class="hljs-string">"Android Message"</span>);
    }
  }
}
</code></pre><p>åˆšè¿è¡Œ APP çš„æ•ˆæœï¼š</p>
<p></p><figure><img class="lazyload inited" data-src="https://user-gold-cdn.xitu.io/2019/4/9/16a003fb7c771a09?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" data-width="425" data-height="768" src="data:image/svg+xml;utf8,<?xml version=&quot;1.0&quot;?><svg xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot; width=&quot;425&quot; height=&quot;768&quot;></svg>"><figcaption></figcaption></figure><p></p>
<p>é€€åå°ï¼Œåˆåˆ‡åˆ°å‰å°çš„æ•ˆæœï¼š</p>
<p></p><figure><img class="lazyload inited" data-src="https://user-gold-cdn.xitu.io/2019/4/9/16a003f51bee4eb6?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" data-width="425" data-height="768" src="data:image/svg+xml;utf8,<?xml version=&quot;1.0&quot;?><svg xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot; width=&quot;425&quot; height=&quot;768&quot;></svg>"><figcaption></figcaption></figure><p></p>
<h2 class="heading" data-id="heading-16">æ€»ç»“</h2>
<p>ä½ ä¼šå‘ç°ï¼ŒMethodChannel å’Œ EventChannel éƒ½å¯ä»¥å®ç° Flutter ä¸ Native çš„åŒå‘é€šä¿¡ï¼Œæ‰€ä»¥ MethodChannel å’Œ EventChannel åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­æ˜¯å¯ä»¥äº’ç›¸æ›¿æ¢çš„ã€‚</p>
<p>åœ¨å®˜æ–¹æ–‡æ¡£é‡Œï¼Œæ›´å¤šçš„æ˜¯å¯¹ MethodChannel çš„ä»‹ç»ï¼ŒEventChannel çš„å‡ ä¹æ²¡æœ‰ï¼Œä½†ä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦å’Œä¹ æƒ¯æ¥é€‰æ‹©ä½¿ç”¨ï¼Œå› ä¸º MethodChannel å’Œ EventChannel çš„åº•å±‚å®ç°æ˜¯ä¸€æ ·çš„ã€‚</p>
</div><section data-v-b60f4e3a="" class="book-comments"><div data-v-b60f4e3a="" class="box-title">ç•™è¨€</div><div data-v-b60f4e3a="" class="comment-box"><div data-v-04c0b04f="" data-v-b60f4e3a="" class="comment-form comment-form" id="comment"><div data-v-59f839d2="" data-v-1074dbe6="" data-v-04c0b04f="" data-src="https://mirror-gold-cdn.xitu.io/16a8d65c9bd0435813b?imageView2/1/w/100/h/100/q/85/format/webp/interlace/1" class="lazy avatar avatar loaded" style="background-image: url(&quot;https://mirror-gold-cdn.xitu.io/16a8d65c9bd0435813b?imageView2/1/w/100/h/100/q/85/format/webp/interlace/1&quot;);"></div><div data-v-6fb14242="" data-v-04c0b04f="" class="auth-card"><div data-v-6fb14242="" class="auth-cover"><span data-v-6fb14242="" class="hint"></span>æ‚¨éœ€è¦<a data-v-6fb14242="">ç»‘å®šæ‰‹æœºå·</a>åæ‰å¯åœ¨æ˜é‡‘ç¤¾åŒºå†…å‘å¸ƒå†…å®¹ã€‚</div><textarea data-v-04c0b04f="" data-v-6fb14242="" placeholder="è¯„è®ºå°†åœ¨åå°è¿›è¡Œå®¡æ ¸ï¼Œå®¡æ ¸é€šè¿‡åå¯¹æ‰€æœ‰äººå¯è§" class="content-input" style="overflow: hidden; overflow-wrap: break-word; height: 60px;"></textarea></div><div data-v-04c0b04f="" class="action-box" style="display: none;"><div data-v-6e2ff326="" data-v-04c0b04f="" class="image-uploader image-uploader" style="display: none;"><input data-v-6e2ff326="" type="file" class="input"><button data-v-6e2ff326="" class="upload-btn"><i data-v-6e2ff326="" class="icon ion-image"></i><span data-v-6e2ff326="">ä¸Šä¼ å›¾ç‰‡</span></button></div><div data-v-04c0b04f="" class="submit-box"><span data-v-04c0b04f="" class="submit-text">Ctrl or âŒ˜ + Enter</span><button data-v-04c0b04f="" class="submit-btn">è¯„è®º</button></div></div><!----></div></div><ul data-v-1ec4f85b="" data-v-b60f4e3a="" st:block="commentList" class="comment-list comment-list"><li data-v-1ec4f85b="" class="item"><div data-v-56cf99ad="" data-v-1ec4f85b="" class="comment"><div data-v-78fb71d8="" data-v-56cf99ad="" st:block="userPopover" st:state="576f476b1532bc005fde68b7" class="user-popover-box"><!----><a data-v-56cf99ad="" href="/user/576f476b1532bc005fde68b7" target="_blank" rel="" data-v-78fb71d8=""><div data-v-59f839d2="" data-v-1074dbe6="" data-v-56cf99ad="" data-src="https://user-gold-cdn.xitu.io/2018/10/29/166bd6922f50dfa8?imageView2/1/w/100/h/100/q/85/format/webp/interlace/1" class="lazy avatar avatar" style="background-image: none;"></div></a></div><div data-v-56cf99ad="" class="content-box"><div data-v-56cf99ad="" class="header"><div data-v-56cf99ad="" class="user-info"><div data-v-78fb71d8="" data-v-56cf99ad="" st:block="userPopover" st:state="576f476b1532bc005fde68b7" class="user-popover-box"><!----><a data-v-07b45902="" data-v-56cf99ad="" href="/user/576f476b1532bc005fde68b7" target="_blank" rel="" class="username" data-v-78fb71d8="">MarkMan<a data-v-6e1ce2d8="" data-v-07b45902="" href="/book/5c90640c5188252d7941f5bb/section/5c9065385188252da6320022" target="_blank" rel="" class="rank"><img data-v-6e1ce2d8="" src="https://b-gold-cdn.xitu.io/v3/static/img/lv-3.e108c68.svg" alt="lv-3"></a></a></div><div data-v-56cf99ad="" class="position">å†™ä»£ç çš„ @ æš‚æ— </div></div></div><div data-v-56cf99ad="" class="content"><!----><span data-v-56cf99ad="" class="content-html">å¦‚æœåœ¨Flutterä¸­åµŒå…¥Android/IOSé¡µé¢çš„æ•™ç¨‹é‚£å°±æ›´å¥½äº†ğŸ˜€</span><!----></div><div data-v-56cf99ad="" class="footer"><button data-v-56cf99ad="" class="like-btn"><i data-v-56cf99ad="" class="collection-arrow-ion ion-arrow-up-b"></i><span data-v-56cf99ad="">0</span></button><span data-v-56cf99ad="" class="sub-comment-btn text-pointer"><span data-v-56cf99ad="" class="title">1æ¡è¯„è®º</span><div data-v-56cf99ad="" class="sub-comment--arrow" style="display: none;"></div></span><span data-v-56cf99ad="" class="date">8å°æ—¶å‰</span><!----></div><!----></div><!----></div></li><!----></ul></section></div></div><!----><!----></div>


</body>
</html>
